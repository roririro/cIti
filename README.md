# cIti


–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –Ω–∞ **Alt Server**, —á—Ç–æ–±—ã –≤—Å–µ –º–∞—à–∏–Ω—ã (–≤–∫–ª—é—á–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏) —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω—É–∂–Ω–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –ª–æ–≥–∏–∫–µ. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º –ø–æ—à–∞–≥–æ–≤–æ, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ç—å –¥–ª—è –≤–∞—à–µ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏.

---

## **–¢–æ–ø–æ–ª–æ–≥–∏—è —Å–µ—Ç–∏**

–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è, —Ç–æ–ø–æ–ª–æ–≥–∏—è —Å–µ—Ç–∏ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```
ControlVM  
INTERNET  

–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏  
Web1  
Web2
```

---

## **1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ç–∏**

### a) **–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π**

1. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å–µ—Ç—å –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –º–∞—à–∏–Ω (Web1, Web2):**

   ```bash
   sudo nmcli connection add type bridge ifname br-internal
   sudo nmcli connection modify br-internal ipv4.addresses 192.168.1.1/24
   sudo nmcli connection modify br-internal ipv4.method manual
   sudo nmcli connection up br-internal
   ```

   - –≠—Ç–∞ —Å–µ—Ç—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–º –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞–º–∏ (Web1, Web2).

2. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å–µ—Ç—å –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (ControlVM, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫):**

   ```bash
   sudo nmcli connection add type bridge ifname br-external
   sudo nmcli connection modify br-external ipv4.addresses 10.0.0.1/24
   sudo nmcli connection modify br-external ipv4.method manual
   sudo nmcli connection up br-external
   ```

   - –≠—Ç–∞ —Å–µ—Ç—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ ControlVM.

---

### b) **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ IP-–∞–¥—Ä–µ—Å–æ–≤**

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ IP-–∞–¥—Ä–µ—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –º–∞—à–∏–Ω—ã:**

   - **ControlVM:**
     - –í–Ω–µ—à–Ω–∏–π IP: `10.0.0.2`
     - –®–ª—é–∑: `10.0.0.1`
   - **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏:**
     - –í–Ω–µ—à–Ω–∏–π IP: `10.0.0.3`
     - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP: `192.168.1.2`
   - **Web1:**
     - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP: `192.168.1.10`
   - **Web2:**
     - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP: `192.168.1.11`

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ IP-–∞–¥—Ä–µ—Å–∞ –Ω–∞ –∫–∞–∂–¥–æ–π –º–∞—à–∏–Ω–µ:**

   –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è **Web1**:

   ```bash
   sudo nmcli connection modify eth0 ipv4.addresses 192.168.1.10/24
   sudo nmcli connection modify eth0 ipv4.gateway 192.168.1.1
   sudo nmcli connection modify eth0 ipv4.method manual
   sudo nmcli connection up eth0
   ```

   –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω.

---

### c) **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏**

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–µ –Ω–∞–≥—Ä—É–∑–∫–∏:**

   –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É –≤–Ω–µ—à–Ω–µ–π –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç—è–º–∏.

   ```bash
   sudo sysctl -w net.ipv4.ip_forward=1
   sudo iptables -t nat -A POSTROUTING -o br-external -j MASQUERADE
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞—Ö (Web1, Web2):**

   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –∫–∞–∫ —à–ª—é–∑ –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.

   ```bash
   sudo ip route add default via 192.168.1.2
   ```

---

## **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏**

### a) **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx**

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx –Ω–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–µ –Ω–∞–≥—Ä—É–∑–∫–∏:**

   ```bash
   sudo apt-get install nginx -y
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏:**

   –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Nginx:

   ```bash
   sudo nano /etc/nginx/nginx.conf
   ```

   –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

   ```nginx
   http {
       upstream backend {
           server 192.168.1.10;
           server 192.168.1.11;
       }

       server {
           listen 80;
           server_name balance.example.com;

           location / {
               proxy_pass http://backend;
           }
       }
   }
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx:**

   ```bash
   sudo systemctl restart nginx
   ```

---

### b) **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

1. **–†–∞–∑—Ä–µ—à–∏—Ç–µ —Ç—Ä–∞—Ñ–∏–∫ –ø–æ HTTP –∏ HTTPS:**

   ```bash
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   ```

2. **–ó–∞–ø—Ä–µ—Ç–∏—Ç–µ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã:**

   ```bash
   sudo ufw default deny incoming
   sudo ufw enable
   ```

---

## **3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ (Web1, Web2)**

### a) **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞**

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, Apache –∏–ª–∏ Nginx):**

   ```bash
   sudo apt-get install apache2 -y
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**

   –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è **Web1**:

   ```bash
   echo "Hello from Web1" | sudo tee /var/www/html/index.html
   ```

   –î–ª—è **Web2**:

   ```bash
   echo "Hello from Web2" | sudo tee /var/www/html/index.html
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:**

   ```bash
   sudo systemctl start apache2
   sudo systemctl enable apache2
   ```

---

## **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫:**

   –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://<IP-–∞–¥—Ä–µ—Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞>`. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –∏–∑ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ (Web1 –∏–ª–∏ Web2).

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É:**

   –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. –í—ã –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å, —á—Ç–æ –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–¥—É—é—Ç—Å—è –º–µ–∂–¥—É Web1 –∏ Web2.

---

## **5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPN –¥–ª—è WebAdm**

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OpenVPN –Ω–∞ WebAdm:**

   ```bash
   sudo apt-get install openvpn -y
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ VPN-—Ç—É–Ω–Ω–µ–ª—å:**

   –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è VPN –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Web1 –∏ Web2.

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**

   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WebAdm –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ Web1 –∏ Web2 —á–µ—Ä–µ–∑ VPN.

---

## **–ò—Ç–æ–≥**

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å–µ—Ç—å, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ã. –í—Å–µ –º–∞—à–∏–Ω—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º, –∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É Web1 –∏ Web2. –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –æ—à–∏–±–∫–∏, –Ω–∞–ø–∏—à–∏—Ç–µ, –∏ —è –ø–æ–º–æ–≥—É –≤–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è! üòä




–•–æ—Ä–æ—à–æ! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∫—Ä–∏–ø—Ç **cloudinit.sh** –Ω–∞ –º–∞—à–∏–Ω–µ **ControlVM** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –Ø –æ–±—ä—è—Å–Ω—é –≤—Å—ë –ø–æ—ç—Ç–∞–ø–Ω–æ.

---

## **1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏**

1. **–°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/home/altlinux/bin`:**

   ```bash
   mkdir -p /home/altlinux/bin
   ```

2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Å–æ–∑–¥–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:**

   ```bash
   cd /home/altlinux/bin
   ```

---

## **2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `cloud.conf`**

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `cloud.conf`:**

   ```bash
   nano /home/altlinux/bin/cloud.conf
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

   ```ini
   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   PROVIDER="aws"  # –ò–ª–∏ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, yandex, google)
   REGION="us-east-1"  # –†–µ–≥–∏–æ–Ω
   ACCESS_KEY="your_access_key"  # –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞
   SECRET_KEY="your_secret_key"  # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á

   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
   LOAD_BALANCER_NAME="my-balancer"
   LOAD_BALANCER_PORT="80"
   BACKEND_SERVERS="192.168.1.10,192.168.1.11"  # IP-–∞–¥—Ä–µ—Å–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤

   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤
   WEB1_IP="192.168.1.10"
   WEB2_IP="192.168.1.11"
   ```

3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∑–∞–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª (`Ctrl + O`, –∑–∞—Ç–µ–º `Ctrl + X`).**

---

## **3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ `cloudinit.sh`**

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `cloudinit.sh`:**

   ```bash
   nano /home/altlinux/bin/cloudinit.sh
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:**

   ```bash
   #!/bin/bash

   # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   source /home/altlinux/bin/cloud.conf

   # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
   check_resource() {
       local resource=$1
       if ping -c 1 "$resource" &> /dev/null; then
           echo "–†–µ—Å—É—Ä—Å $resource –¥–æ—Å—Ç—É–ø–µ–Ω."
       else
           echo "–û—à–∏–±–∫–∞: —Ä–µ—Å—É—Ä—Å $resource –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω."
           exit 1
       fi
   }

   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤
   echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤..."
   for server in $(echo "$BACKEND_SERVERS" | tr ',' ' '); do
       check_resource "$server"
   done

   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
   echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏..."
   check_resource "$LOAD_BALANCER_NAME"

   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (–ø—Ä–∏–º–µ—Ä –¥–ª—è AWS)
   echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏..."
   aws elbv2 create-load-balancer \
       --name "$LOAD_BALANCER_NAME" \
       --subnets subnet-12345678 \
       --security-groups sg-12345678 \
       --region "$REGION"

   # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫
   echo "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫..."
   for server in $(echo "$BACKEND_SERVERS" | tr ',' ' '); do
       aws elbv2 register-targets \
           --target-group-arn "arn:aws:elasticloadbalancing:$REGION:123456789012:targetgroup/my-target-group" \
           --targets "Id=$server,Port=80"
   done

   echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
   ```

3. **–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:**

   ```bash
   chmod +x /home/altlinux/bin/cloudinit.sh
   ```

---

## **4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**

   - –î–ª—è —Ä–∞–±–æ—Ç—ã —Å AWS CLI (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AWS):

     ```bash
     sudo apt-get install awscli -y
     ```

   - –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –æ–±–ª–∞—á–Ω–æ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É:**

   - –î–ª—è AWS:

     ```bash
     aws configure
     ```

     –í–≤–µ–¥–∏—Ç–µ `ACCESS_KEY`, `SECRET_KEY`, `REGION` –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

---

## **5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:**

   ```bash
   /home/altlinux/bin/cloudinit.sh
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥:**
   - –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏.
   - –ï—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞."

---

## **6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**

1. **–î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –í –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ:

     ```bash
     LOG_FILE="/home/altlinux/bin/cloudinit.log"
     exec > >(tee -a "$LOG_FILE") 2>&1
     ```

   - –≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –≤—ã–≤–æ–¥—ã —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Ñ–∞–π–ª `cloudinit.log`.

2. **–î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `set -e` –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞, —á—Ç–æ–±—ã –æ–Ω –∑–∞–≤–µ—Ä—à–∞–ª—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ.

3. **–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `awscli`) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

     ```bash
     if ! command -v aws &> /dev/null; then
         echo "–û—à–∏–±–∫–∞: awscli –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
         exit 1
     fi
     ```

---

## **–ò—Ç–æ–≥**

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç **cloudinit.sh**, –∫–æ—Ç–æ—Ä—ã–π:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞ `cloud.conf`.
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤.
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ã.

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –æ—à–∏–±–∫–∏, –Ω–∞–ø–∏—à–∏—Ç–µ, –∏ —è –ø–æ–º–æ–≥—É –≤–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è! üòä












https://dzen.ru/a/Z8oUcB8cdyPBusex

